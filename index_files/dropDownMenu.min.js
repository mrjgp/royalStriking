"use strict";define("dropDownMenu",["lodash","utils","core","santaProps","menuButton","reactDOM"],function(e,t,n,i,o,r){function s(e,n,i){return"userLang"===e?t.wixUserApi.getLanguage(n,i):e}function a(e){return!isNaN(parseFloat(e))&&isFinite(e)}function h(t){return e.filter(t,"isVisible")}function u(e,t,n,i,o,r){return r===e.length-1?1===e.length?"dropLonely":t?"bottom":n||"right"===i?o?"left":"right":"center":0===r?t?"top":n||"left"===i?o?"right":"left":"center":t?"dropCenter":"center"}function p(n,i,o,r,s){var a,h=e.some(o,["link.pageId.id",i]),u={AnchorLink:function(t){return(e.has(t.anchorDataId,"id")?t.anchorDataId.id:t.anchorDataId)===a},PageLink:function(e){if(!a){if(e.pageId.isPopup)return e.pageId.id===i;if(!h)return e.pageId.id===n}return!1}};return r&&(a=t.menuUtils.getActiveAnchorInPage(s,o,n)),function(e){var t=e&&u[e.type];return!!t&&t(e)}}function l(t,n,i,o,r,s,a,h,l){return e.map(n,function(e,d){var c=e.link,m=p(s,a,n,l,t);return{isContainer:Boolean(i),isSelected:m(c),positionInList:u(n,i,o,r,h,d)}})}var d=n.compMixins,c=["da","de","en","es","fr","hi","it","ja","ko","nl","no","pl","pt","ru","sv","tr"];return{displayName:"DropDownMenu",propTypes:e.assign({isMobileView:i.Types.isMobileView,isMobileDevice:i.Types.Device.isMobileDevice,isTabletDevice:i.Types.Device.isTabletDevice,anchorChangeEvent:i.Types.SiteAspects.anchorChangeEvent,activeAnchorData:i.Types.AnchorChange.activeAnchorData,currentUrlPageId:i.Types.Component.currentUrlPageId,currentPopupId:i.Types.currentPopupId,highlightAnchorsInMenu:i.Types.BrowserFlags.highlightAnchorsInMenu.isRequired,siteMenuWithRender:i.Types.Menu.siteMenuWithRender,nonHiddenPageIdsFromMainMenu:i.Types.Menu.nonHiddenPageIdsFromMainMenu,id:i.Types.Component.id,refInParent:i.Types.Component.refInParent,skin:i.Types.Component.skin,compProp:i.Types.Component.compProp,compData:i.Types.Component.compData},i.santaTypesUtils.getSantaTypesByDefinition(o)),statics:{useSantaTypes:!0},mixins:[d.skinBasedComp,d.timeoutsMixin,d.skinInfo],getInitialState:function(){return this.shouldChildrenUpdate=!1,{hover:null,hoverListPosition:null,activeAnchor:null,$dropAlign:this.props.compProp.alignButtons,$mobile:this.props.isMobileDevice||this.props.isMobileView||this.props.isTabletDevice?"mobile":"notMobile"}},componentDidMount:function(){this.props.highlightAnchorsInMenu&&this.props.anchorChangeEvent.registerToAnchorChange(this)},componentWillUnmount:function(){this.props.highlightAnchorsInMenu&&this.props.anchorChangeEvent.unregisterToAnchorChange(this)},convertItemsToChildren:function(t,n,i,o){var r=h(t);(n=n||{}).style=n.style||{};var s=l(this.state.activeAnchor,r,o,this.props.compProp.stretchButtonsToMenuWidth,this.props.compProp.alignButtons,this.props.currentUrlPageId,this.props.currentPopupId,this.props.compProp.rtl,this.props.highlightAnchorsInMenu);return e.map(r,function(t,i){var r=(o?"moreContainer":"")+i;return this.createChildComponent(t,"core.components.MenuButton","repeaterButton",e.merge({isContainer:s[i].isContainer,isSelected:s[i].isSelected,positionInList:s[i].positionInList,id:this.props.id+r,ref:r,key:t.id,refInParent:r,mouseEnterHandler:this.mouseEnterHandler,mouseLeaveHandler:this.mouseLeaveHandler,isDropDownButton:o,onMouseClick:this.onMouseClick,"aria-haspopup":t.items.length>0,direction:this.props.compProp.rtl?"rtl":"ltr"},n))}.bind(this))},onMouseClick:function(e,t,n){var i=h(this.props.siteMenuWithRender);if(n)this.mouseLeaveHandler();else{var o=[];"__more__"!==t&&(o=h(i[t].items));var r=o.length>0||"__more__"===t,s=this.state.hover;!this.dropDownOpen&&r?(this.mouseEnterHandler(t),e.preventDefault(),e.stopPropagation()):this.dropDownOpen&&!this.isDropdownOwner(t,s)&&r?(this.mouseLeaveHandler(),e.preventDefault(),e.stopPropagation(),this.mouseEnterHandler(t)):this.dropDownOpen&&this.mouseLeaveHandler()}},onAnchorChange:function(e){e!==this.state.activeAnchor&&this.setState({activeAnchor:e})},isDropdownOwner:function(e,t){return e===t},createMoreButton:function(e){var t=e?"left":"right",n=this.props.compProp.alignButtons;return this.props.compProp.stretchButtonsToMenuWidth||"right"===n||(t="center"),this.createChildComponent({id:"__more__",label:this.props.compProp.moreButtonLabel},"core.components.MenuButton","repeaterButton",{isSelected:!1,positionInList:t,id:this.props.id+"__more__",ref:"__more__",key:"__more__",mouseEnterHandler:this.mouseEnterHandler,mouseLeaveHandler:this.mouseLeaveHandler,onFocus:this.mouseEnterHandler,onBlur:this.mouseLeaveHandler,"aria-haspopup":!0,onKeyDown:this.subMenuKeyBoardClickHandler,onMouseClick:this.onMouseClick,isDropDownButton:!1,display:"inline-block"})},mouseEnterHandler:function(e,n){this.hovering=!0,this.lastHovered=this.getCurrentTime();var i=e.replace(this.props.id,"");-1!==this.props.nonHiddenPageIdsFromMainMenu.concat("__more__").indexOf(i)&&(a(i)||t.stringUtils.startsWith(e,"__"))&&e!==this.state.hover&&(this.state.hover&&this.refs[this.state.hover].setIdleState(),this.registerReLayout(),this.setState({hover:e,hoverListPosition:n}))},getCurrentTime:function(){return Date.now()},mouseLeaveHandler:function(){this.hovering=!1,this.lastHovered=this.getCurrentTime(),!this.dropDownOpen&&this.state.hover&&this.refs[this.state.hover].setIdleState(),this.setTimeout(function(){var e=this.getCurrentTime()-this.lastHovered;!this.hovering&&this.state.hover&&e>=1e3&&(this.refs[this.state.hover].setIdleState(),this.dropDownOpen=!1,this.setState({hover:null,hoverListPosition:null}))}.bind(this),1e3)},getParamsFromSkins:function(){return{menuBorderY:this.getSumParamValue("menuTotalBordersY",this.props.skin),menuBtnBorder:this.getSumParamValue("menuButtonBorders",this.getSkinExports().repeaterButton.skin),ribbonEls:this.getParamFromDefaultSkin("ribbonEls").value?parseInt(this.getParamFromDefaultSkin("ribbonEls").value,10):0,labelPad:this.getFromExports("labelPad"),ribbonExtra:this.getFromExports("ribbonExtra")?Math.abs(parseInt(this.getFromExports("ribbonExtra"),10)):0}},shiftFocusToSubMenu:function(e){var t=this.refs["moreContainer"+e];r.findDOMNode(t).focus(),this.currentFocusedSubMenuIndex=e},getFirstIndexOfSubMenu:function(){for(var e,t=0;t<this.subMenuItems.length;t++)if(e=r.findDOMNode(this.refs["moreContainer"+t]),"none"!==window.getComputedStyle(e).display)return t;return 0},mainMenuKeyDownHandler:function(e){if(this.dropDownOpen){var t;"ArrowDown"===e.key&&(e.stopPropagation(),e.preventDefault(),t=this.getFirstIndexOfSubMenu(),this.shiftFocusToSubMenu(t)),"ArrowUp"===e.key&&(e.stopPropagation(),e.preventDefault(),t=this.subMenuItems.length,this.shiftFocusToSubMenu(t))}},subMenuKeyDownHandler:function(e){var t;("ArrowDown"===e.key||!e.shiftKey&&"Tab"===e.key)&&(e.stopPropagation(),e.preventDefault(),(t=this.currentFocusedSubMenuIndex+1)===this.subMenuItems.length&&(t=this.getFirstIndexOfSubMenu()),this.shiftFocusToSubMenu(t)),("ArrowUp"===e.key||e.shiftKey&&"Tab"===e.key)&&(e.stopPropagation(),e.preventDefault(),((t=this.currentFocusedSubMenuIndex-1)<0||t<this.getFirstIndexOfSubMenu())&&(t=this.subMenuItems.length-1),this.shiftFocusToSubMenu(t)),"Escape"===e.key&&(e.stopPropagation(),e.preventDefault(),"__more__"===this.state.hover?r.findDOMNode(this.refs[this.state.hover]).focus():this.refs.itemsContainer.children[this.state.hover].focus(),this.setState({hover:null}))},getLanguage:function(){var t=s(this.props.compProp.dataLang,this.props.cookie,this.props.currentUrl);return e.includes(c,t)?t:"en"},getAriaLabel:function(){var n=this.getLanguage();return e.get(t.translations.blogTranslations,[n,"mainMenuAriaLabel"],"Site navigation")},getSkinProperties:function(){var e=h(this.props.siteMenuWithRender),t=this.getParamsFromSkins(),n=this.convertItemsToChildren(e,{display:"inherit"},null,null),i=[],o="hidden";return n.push(this.createMoreButton(this.props.compProp.rtl)),(a(this.state.hover)||"__more__"===this.state.hover)&&(i=this.convertItemsToChildren(a(this.state.hover)?e[this.state.hover].items:e,{style:{width:"100%"},display:"block",prefix:"_",subMenu:!0},!0,!0)).length>0&&(o="inherit",this.dropDownOpen=!0,this.subMenuItems=i),{"":{id:this.props.id,key:this.props.refInParent,ref:this.props.refInParent,"data-menuborder-y":t.menuBorderY,"data-menubtn-border":t.menuBtnBorder,"data-ribbon-els":t.ribbonEls,"data-label-pad":t.labelPad,"data-ribbon-extra":t.ribbonExtra,"data-drophposition":this.state.hover?this.state.hoverListPosition:"","data-dropalign":this.props.compProp.alignButtons,dir:this.props.compProp.rtl?"rtl":"ltr",tagName:"nav"},itemsContainer:{children:n,style:{textAlign:this.props.compProp.alignButtons},onKeyDown:this.mainMenuKeyDownHandler,role:"navigation","aria-label":this.getAriaLabel()},moreContainer:{onKeyDown:this.subMenuKeyDownHandler,children:i,"data-hover":this.state.hover,style:{visibility:o},id:"subMenuContainer"},dropWrapper:{style:{visibility:o},"data-drophposition":this.state.hover?this.state.hoverListPosition:"","data-dropalign":this.props.compProp.alignButtons,role:"navigation"}}}}});
//# sourceMappingURL=dropDownMenu.min.js.map